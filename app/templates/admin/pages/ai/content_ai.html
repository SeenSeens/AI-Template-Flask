{% extends 'admin/layout/base.html' %}
{% block title %}{{ page_title }}{% endblock %}

{% block content %}
{% include 'admin/components/breadcrumb.html' %}

<div class="container-fluid">
    <form method="POST" action="" class="p-4 border rounded shadow-sm bg-white">
        <h3 class="mb-4">‚öôÔ∏è C·∫•u h√¨nh AI cho vi·∫øt n·ªôi dung</h3>
        <!-- Preset l·ª±a ch·ªçn ho·∫∑c t·∫°o m·ªõi -->
        <div class="mb-3">
            <label class="form-label">Ch·ªçn preset n·ªôi dung:</label>
            <select name="preset_id" class="form-select">
                {% for preset in presets %}
                <option value="{{ preset.id }}">{{ preset.use_case }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label class="form-label">Ho·∫∑c t·∫°o m·ªõi preset:</label>
            <input type="text" name="use_case" class="form-control" placeholder="V√≠ d·ª•: blog-writing, seo-copy, email-campaign">
        </div>
        <!-- Tham s·ªë model -->
        <div class="row">
            <div class="col-md-4">
                <label class="form-label">Temperature:</label>
                <input type="number" step="0.1" name="temperature" value="0.7" class="form-control" min="0" max="1">
            </div>
            <div class="col-md-4">
                <label class="form-label">Top P:</label>
                <input type="number" step="0.1" name="top_p" value="0.9" class="form-control" min="0" max="1">
            </div>
            <div class="col-md-4">
                <label class="form-label">Max Tokens:</label>
                <input type="number" name="max_tokens" value="1024" class="form-control">
            </div>
        </div>
        <div class="mt-3 mb-3">
            <label class="form-label">Frequency Penalty:</label>
            <input type="number" step="0.1" name="frequency_penalty" value="0.2" class="form-control" min="0" max="2">
        </div>
        <!-- T√≠nh nƒÉng -->
        <fieldset class="border p-3 mb-3">
            <legend class="w-auto px-2">üß† T√≠nh nƒÉng h·ªó tr·ª£</legend>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="autocomplete" id="autocomplete" checked>
                <label class="form-check-label" for="autocomplete">T·ª± ƒë·ªông ho√†n th√†nh n·ªôi dung</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="summarize" id="summarize">
                <label class="form-check-label" for="summarize">T√≥m t·∫Øt n·ªôi dung</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="translate" id="translate">
                <label class="form-check-label" for="translate">D·ªãch n·ªôi dung</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" name="multi_chat" id="multi_chat">
                <label class="form-check-label" for="multi_chat">Chat ƒëa l∆∞·ª£t (multi-turn)</label>
            </div>
            <div class="form-check mt-2">
                <input class="form-check-input" type="checkbox" name="is_default" id="is_default">
                <label class="form-check-label" for="is_default">ƒê·∫∑t l√†m c·∫•u h√¨nh m·∫∑c ƒë·ªãnh</label>
            </div>
        </fieldset>
        <!-- JSON m·ªü r·ªông -->
        <div class="mb-3">
            <label class="form-label">üéØ Th√¥ng s·ªë b·ªï sung (JSON):</label>
            <textarea name="features" rows="5" class="form-control" placeholder='{
                "tone": "friendly",
                "language": "vi",
                "style": "blog",
                "output_format": "html"
                }'></textarea>
        </div>
        <button type="submit" class="btn btn-primary">üíæ L∆∞u c·∫•u h√¨nh</button>
    </form>

    <div class="mt-5">
        <h2>üìù Ki·ªÉm tra t·∫°o n·ªôi dung b·∫±ng AI (Gemini)</h2>
        <form id="ai-content-form" method="post">
            <div class="mb-3">
                <label for="prompt" class="form-label">Ch·ªß ƒë·ªÅ / Y√™u c·∫ßu</label>
                <textarea class="form-control" id="prompt" name="prompt" rows="4" placeholder="VD: Vi·∫øt m·ªôt b√†i blog gi·ªõi thi·ªáu v·ªÅ AI trong gi√°o d·ª•c..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">‚ö° T·∫°o n·ªôi dung</button>
        </form>

        <div class="mt-4" id="result-box" style="display:none;">
            <h5>K·∫øt qu·∫£:</h5>
            <div id="result-content" class="border rounded p-3 bg-light"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById("ai-content-form").addEventListener("submit", async function(e) {
    e.preventDefault();
    const prompt = document.getElementById("prompt").value;
    const resultBox = document.getElementById("result-box");
    const resultContent = document.getElementById("result-content");

    resultBox.style.display = "none";
    resultContent.innerHTML = "ƒêang t·∫°o n·ªôi dung...";

    try {
        const res = await axios.post("/admin/generate-content", { prompt });
        resultBox.style.display = "block";
        resultContent.innerHTML = res.data.content || "Kh√¥ng c√≥ n·ªôi dung tr·∫£ v·ªÅ.";
    } catch (err) {
        resultContent.innerHTML = err.response?.data?.error || "ƒê√£ x·∫£y ra l·ªói khi sinh n·ªôi dung.";
        resultBox.style.display = "block";
    }
});
</script>
{% endblock %}
