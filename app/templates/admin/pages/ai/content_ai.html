{% extends 'admin/layout/base.html' %}
{% block title %}{{ page_title }}{% endblock %}

{% block content %}
{% include 'admin/components/breadcrumb.html' %}

<div class="container-fluid">
    <form method="POST" action="{{ url_for('admin.config_content_ai') }}">
        {{ form.hidden_tag() }}
        <h3 class="mb-4">‚öôÔ∏è C·∫•u h√¨nh AI cho vi·∫øt n·ªôi dung</h3>
        <div class="row">
            <div class="mb-3 col-12 col-md-6">
                {{ form.use_case.label(class="form-label", for="use_case") }}
                {{ form.use_case(class="form-control", placeholder="v√≠ d·ª•: V√≠ d·ª•: blog-writing, seo-copy, email-campaign") }}
                {% if form.use_case.errors %}
                    <div class="text-danger">{{ form.use_case.errors[0] }}</div>
                {% endif %}
            </div>
            <!-- Preset l·ª±a ch·ªçn ho·∫∑c t·∫°o m·ªõi -->
            <div class="mb-3 col-12 col-md-6">
                {{ form.type.label(class="form-label", for="type") }}
                {{ form.type(class="form-select") }}
                {% if form.type.errors %}
                    <div class="text-danger">{{ form.type.errors[0] }}</div>
                {% endif %}
            </div>
        </div>
        <!-- Tham s·ªë model -->
        <div class="row">
            <div class="col-md-4">
                {{ form.temperature.label(class="form-label", for="temperature") }}
                {{ form.temperature(class="form-control") }}
                {% if form.temperature.errors %}
                    <div class="text-danger">{{ form.temperature.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-md-4">
                {{ form.top_p.label(class="form-label", for="top_p") }}
                {{ form.top_p(class="form-control") }}
                {% if form.top_p.errors %}
                    <div class="text-danger">{{ form.top_p.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-md-4">
                {{ form.max_tokens.label(class="form-label", for="max_tokens") }}
                {{ form.max_tokens(class="form-control") }}
                {% if form.max_tokens.errors %}
                    <div class="text-danger">{{ form.max_tokens.errors[0] }}</div>
                {% endif %}
            </div>
        </div>
        <div class="mt-3 mb-3">
            {{ form.frequency_penalty.label(class="form-label", for="frequency_penalty") }}
            {{ form.frequency_penalty(class="form-control") }}
            {% if form.frequency_penalty.errors %}
                <div class="text-danger">{{ form.frequency_penalty.errors[0] }}</div>
            {% endif %}
        </div>
        <!-- T√≠nh nƒÉng -->
        <fieldset class="border p-3 mb-3">
            <legend class="w-auto px-2">üß† T√≠nh nƒÉng h·ªó tr·ª£</legend>
            <div class="form-check">
                {{ form.autocomplete(class="form-check-input", id="autocomplete") }}
                {{ form.autocomplete.label(class="form-label", for="autocomplete") }}
                {% if form.autocomplete.errors %}
                    <div class="text-danger">{{ form.autocomplete.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="form-check">
                {{ form.summarize(class="form-check-input", id="summarize") }}
                {{ form.summarize.label(class="form-label", for="summarize") }}
                {% if form.summarize.errors %}
                    <div class="text-danger">{{ form.summarize.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="form-check">
                {{ form.translate(class="form-check-input", id="translate") }}
                {{ form.translate.label(class="form-label", for="translate") }}
                {% if form.translate.errors %}
                    <div class="text-danger">{{ form.translate.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="form-check">
                {{ form.multi_chat(class="form-check-input", id="multi_chat") }}
                {{ form.multi_chat.label(class="form-label", for="multi_chat") }}
                {% if form.multi_chat.errors %}
                    <div class="text-danger">{{ form.multi_chat.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="form-check">
                {{ form.is_default(class="form-check-input", id="is_default") }}
                {{ form.is_default.label(class="form-label", for="is_default") }}
                {% if form.is_default.errors %}
                    <div class="text-danger">{{ form.is_default.errors[0] }}</div>
                {% endif %}
            </div>
        </fieldset>
        <!-- JSON m·ªü r·ªông -->
        <div class="mb-3">
            {{ form.features.label(class="form-label", for="features") }}
            {{ form.features }}
            {% if form.features.errors %}
                <div class="text-danger">{{ form.features.errors[0] }}</div>
            {% endif %}
        </div>
        <div class="mt-4">
            <button type="submit" class="btn btn-primary">üíæ L∆∞u c·∫•u h√¨nh</button>
            <a href="" class="btn btn-secondary">Quay l·∫°i</a>
        </div>
    </form>

    <div class="mt-5">
        <h2>üìù Ki·ªÉm tra t·∫°o n·ªôi dung b·∫±ng AI (Gemini)</h2>
        <form id="ai-content-form" method="post">
            <div class="mb-3">
                <label for="prompt" class="form-label">Ch·ªß ƒë·ªÅ / Y√™u c·∫ßu</label>
                <textarea class="form-control" id="prompt" name="prompt" rows="4" placeholder="VD: Vi·∫øt m·ªôt b√†i blog gi·ªõi thi·ªáu v·ªÅ AI trong gi√°o d·ª•c..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary">‚ö° T·∫°o n·ªôi dung</button>
        </form>

        <div class="mt-4" id="result-box" style="display:none;">
            <h5>K·∫øt qu·∫£:</h5>
            <div id="result-content" class="border rounded p-3 bg-light"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById("ai-content-form").addEventListener("submit", async function(e) {
    e.preventDefault();
    const prompt = document.getElementById("prompt").value;
    const resultBox = document.getElementById("result-box");
    const resultContent = document.getElementById("result-content");

    resultBox.style.display = "none";
    resultContent.innerHTML = "ƒêang t·∫°o n·ªôi dung...";

    try {
        const res = await axios.post("/admin/generate-content", { prompt });
        resultBox.style.display = "block";
        resultContent.innerHTML = res.data.content || "Kh√¥ng c√≥ n·ªôi dung tr·∫£ v·ªÅ.";
    } catch (err) {
        resultContent.innerHTML = err.response?.data?.error || "ƒê√£ x·∫£y ra l·ªói khi sinh n·ªôi dung.";
        resultBox.style.display = "block";
    }
});
</script>
{% endblock %}
